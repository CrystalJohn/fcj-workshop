<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="phuctptse183992@fpt.edu.vn"><link rel=icon href=../../../images/favicon.png type=image/png><title>Xây dựng Golden Image với CIS Linux Build Kit trong Amazon EC2 Image Builder :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765512673 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765512673 rel=stylesheet><link href=../../../css/hybrid.css?1765512673 rel=stylesheet><link href=../../../css/featherlight.min.css?1765512673 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765512673 rel=stylesheet><link href=../../../css/auto-complete.css?1765512673 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765512673 rel=stylesheet><link href=../../../css/theme.css?1765512673 rel=stylesheet><link href=../../../css/hugo-theme.css?1765512673 rel=stylesheet><link href=../../../css/theme-workshop.css?1765512673 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765512673></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.3-blog3/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765512673></script><script type=text/javascript src=../../../js/auto-complete.js?1765512673></script><script type=text/javascript>var baseurl="https://crystaljohn.github.io/fcj-workshop//vi"</script><script type=text/javascript src=../../../js/search.js?1765512673></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12 </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các Blog Đã Dịch" class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Các Blog Đã Dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Xây dựng nhà khí tượng ảo bằng Amazon Bedrock Agents" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Xây dựng nhà khí tượng ảo bằng Amazon Bedrock Agents
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Xây dựng pipeline Apache Spark end-to-end với Amazon MWAA, Batch Processing Gateway và Amazon EMR trên EKS" class=dd-item><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Xây dựng pipeline Apache Spark end-to-end với Amazon MWAA, Batch Processing Gateway và Amazon EMR trên EKS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Xây dựng Golden Image với CIS Linux Build Kit trong Amazon EC2 Image Builder" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Xây dựng Golden Image với CIS Linux Build Kit trong Amazon EC2 Image Builder
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../../vi/4-eventparticipated/4.3-event3/><b>4.2. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../../vi/4-eventparticipated/4.4-event4/><b>4.2. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/1-introduction/ title="Giới thiệu" class=dd-item><a href=../../../vi/5-workshop/1-introduction/><b>1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/2-preparation/ title="Các bước chuẩn bị" class=dd-item><a href=../../../vi/5-workshop/2-preparation/><b>2. </b>Các bước chuẩn bị
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/3-bedrock-models/ title="Kích hoạt Bedrock Models" class=dd-item><a href=../../../vi/5-workshop/3-bedrock-models/><b>3. </b>Kích hoạt Bedrock Models
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/4-aws-cli/ title="Cấu hình AWS CLI" class=dd-item><a href=../../../vi/5-workshop/4-aws-cli/><b>4. </b>Cấu hình AWS CLI
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5-data-preparation/ title="Chuẩn bị Dữ liệu" class=dd-item><a href=../../../vi/5-workshop/5-data-preparation/><b>5. </b>Chuẩn bị Dữ liệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/6-infrastructure/ title="Triển khai giải pháp" class=dd-item><a href=../../../vi/5-workshop/6-infrastructure/><b>6. </b>Triển khai giải pháp
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/7-backend/ title="Thiết lập Backend API" class=dd-item><a href=../../../vi/5-workshop/7-backend/><b>7. </b>Thiết lập Backend API
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/8-idp-pipeline/ title="Thiết lập IDP Pipeline" class=dd-item><a href=../../../vi/5-workshop/8-idp-pipeline/><b>8. </b>Thiết lập IDP Pipeline
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/9-frontend/ title="Thiết lập Frontend" class=dd-item><a href=../../../vi/5-workshop/9-frontend/><b>9. </b>Thiết lập Frontend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/10-using-chatbot/ title="Sử dụng Chatbot" class=dd-item><a href=../../../vi/5-workshop/10-using-chatbot/><b>10. </b>Sử dụng Chatbot
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/11-admin-dashboard/ title="Sử dụng Admin Dashboard" class=dd-item><a href=../../../vi/5-workshop/11-admin-dashboard/><b>11. </b>Sử dụng Admin Dashboard
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/12-cleanup/ title="Dọn dẹp Tài nguyên" class=dd-item><a href=../../../vi/5-workshop/12-cleanup/><b>12. </b>Dọn dẹp Tài nguyên
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://crystaljohn.github.io/fcj-workshop/3-blogstranslated/3.3-blog3/>English</option><option id=vi value=https://crystaljohn.github.io/fcj-workshop/vi/3-blogstranslated/3.3-blog3/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Các Blog Đã Dịch</a> > Xây dựng Golden Image với CIS Linux Build Kit trong Amazon EC2 Image Builder</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#bởi-rajat-chatterjee>Bởi: Rajat Chatterjee</a></li><li><a href=#giới-thiệu>Giới thiệu</a></li><li><a href=#tổng-quan-giải-pháp>Tổng quan giải pháp</a></li><li><a href=#tiền-đề-cho-giải-pháp>Tiền đề cho giải pháp</a><ul><li><a href=#tải-xuống-khám-phá-và-cập-nhật-cis-lbk-utility>Tải xuống, khám phá và cập nhật CIS LBK Utility</a></li><li><a href=#tạo-bucket-s3-staging-và-tải-lên-lbk>Tạo bucket S3 staging và tải lên LBK</a></li><li><a href=#cấu-hình-bucket-s3-để-gửi-thông-báo-qua-amazon-eventbridge>Cấu hình bucket S3 để gửi thông báo qua Amazon EventBridge</a></li></ul></li><li><a href=#các-bước-triển-khai>Các bước triển khai</a></li><li><a href=#xây-dựng-image-building-pipeline-bằng-ec2-image-builder>Xây dựng Image Building Pipeline bằng EC2 Image Builder</a><ul><li><a href=#tạo-component-tùy-chỉnh-cho-ec2-image-builder>Tạo Component tùy chỉnh cho EC2 Image Builder</a></li><li><a href=#tạo-image-recipe-dựa-trên-component>Tạo Image Recipe dựa trên Component</a></li><li><a href=#tạo-workflow-tùy-chỉnh-cho-quá-trình-build-image>Tạo Workflow tùy chỉnh cho quá trình Build Image</a></li><li><a href=#tạo-image-pipeline>Tạo Image Pipeline</a></li><li><a href=#gắn-bucket-policy-cho-s3-bucket-cis-lbk-al2>Gắn Bucket Policy cho S3 Bucket cis-lbk-al2</a></li><li><a href=#tạo-amazon-sns-topic-cho-email-notification>Tạo Amazon SNS Topic cho Email Notification</a></li><li><a href=#tạo-amazon-eventbridge-rules-để-gửi-thông-báo>Tạo Amazon EventBridge Rules để gửi thông báo</a></li><li><a href=#chạy-image-pipeline>Chạy Image Pipeline</a></li></ul></li><li><a href=#kiểm-thử-image-bằng-amazon-inspector>Kiểm thử Image bằng Amazon Inspector</a><ul><li><a href=#tiếp-tục-hoặc-dừng-workflow>Tiếp tục hoặc dừng workflow</a></li></ul></li><li><a href=#kết-luận>Kết luận</a></li><li><a href=#đọc-thêm>Đọc thêm</a></li><li><a href=#về-tác-giả>Về tác giả</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Xây dựng Golden Image với CIS Linux Build Kit trong Amazon EC2 Image Builder</h1><h2 id=bởi-rajat-chatterjee>Bởi: Rajat Chatterjee</h2><p><strong>Ngày:</strong> 11 Tháng 5, 2025</p><p><strong>Chủ đề:</strong> <a href=https://aws.amazon.com/blogs/mt/category/security-identity-compliance/amazon-inspector/>Amazon Inspector</a>, <a href=https://aws.amazon.com/blogs/mt/category/management-and-governance/enterprise-governance-and-control/>Enterprise Governance and Control</a>, <a href=https://aws.amazon.com/blogs/mt/category/learning-levels/expert-400/>Expert (400)</a>, <a href=https://aws.amazon.com/blogs/mt/category/management-tools/>Management Tools</a>, <a href=https://aws.amazon.com/blogs/mt/category/post-types/technical-how-to/>Technical How-to</a></p><hr><h2 id=giới-thiệu>Giới thiệu</h2><p>Việc xây dựng và triển khai các hệ điều hành (Operating System – OS) đã được harden và chứng nhận bảo mật là yêu cầu thiết yếu đối với bất kỳ đội ngũ Cloud Operations (CloudOps) hoặc Cloud Center of Excellence (CCoE) nào trong tổ chức. Các hướng dẫn và biện pháp kiểm soát bảo mật được sử dụng để chứng nhận các image này thường đến từ đội ngũ bảo mật nội bộ, dựa trên các tiêu chuẩn được công nhận rộng rãi trong ngành.</p><p>Tuy nhiên, bạn cũng cần khả năng kiểm soát quy trình hardening, với sự linh hoạt để chọn lựa các bước khắc phục và kịch bản triển khai ứng dụng phù hợp. Kết quả là hình thành nên &ldquo;<a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html>Golden Amazon Machine Images</a> (AMI)&rdquo; – các image được các đơn vị nghiệp vụ (Business Units) sử dụng trực tiếp.</p><p>Quy trình này cần có tự động hóa, để việc xây dựng và kiểm thử diễn ra ở quy mô lớn và các image được phân phối thông qua <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html>Amazon Machine Images</a> (AMI) đã được phê duyệt. Một trong những tiêu chuẩn phổ biến được sử dụng làm cơ sở (baseline) cho việc harden image là <a href=https://www.cisecurity.org/>Center for Internet Security</a> (CIS) — tổ chức tạo và duy trì một bộ hướng dẫn cấu hình được gọi là <a href=https://www.cisecurity.org/benchmark>CIS Benchmarks</a>, cung cấp các thực hành cấu hình tốt nhất (best practices) cho các công nghệ cụ thể như hệ điều hành, nền tảng đám mây, ứng dụng và cơ sở dữ liệu.</p><p><a href=https://www.cisecurity.org/benchmark>CIS Benchmarks</a> được công nhận rộng rãi trong ngành và được nhiều tiêu chuẩn như PCI DSS, HIPAA, DoD Cloud Computing SRG, FISMA, DFARS, và FEDRAMP tham chiếu.</p><p>Trong bài viết này, chúng tôi chọn benchmark của CIS cho Amazon Linux, và xây dựng một quy trình để tạo AMI được chứng nhận thông qua tự động hóa có thể vận hành ở quy mô lớn.</p><p>Bạn có thể sử dụng một trong hai cách tiếp cận để tạo Golden Images bằng cách áp dụng <a href=https://www.cisecurity.org/cis-benchmarks>CIS Benchmark</a> cho hệ điều hành (OS) tương ứng nhằm harden AMI:</p><ol><li><p><strong>Sử dụng component được quản lý với CIS AMI từ <a href=https://aws.amazon.com/marketplace/>AWS Marketplace</a></strong> – Bạn cũng sẽ có quyền truy cập vào hardening component đi kèm, chạy các script để áp dụng hướng dẫn <a href=https://www.cisecurity.org/cis-benchmarks>CIS Benchmark</a> Level 1 cho cấu hình của mình. Các component này do tổ chức CIS sở hữu và duy trì để đảm bảo luôn cập nhật theo hướng dẫn mới nhất. (Chi tiết về cách tiếp cận này có thể xem tại bài viết <a href=https://aws.amazon.com/blogs/mt/building-cis-hardened-golden-images-and-pipelines-with-ec2-image-builder/>Building CIS hardened Golden Images and Pipelines with EC2 Image Builder</a>).</p></li><li><p><strong>Sử dụng quy trình hardening tự quản bằng <a href=https://aws.amazon.com/image-builder/>Amazon EC2 Image Builder</a></strong> – Cách tiếp cận này mang lại sự linh hoạt cho đội ngũ CloudOps trong việc tùy chỉnh quy trình hardening, giúp họ có thể loại trừ các khuyến nghị trong benchmark có thể ảnh hưởng đến ứng dụng dự kiến triển khai trên instance sử dụng AMI.</p></li></ol><p>Bạn có thể chọn một trong hai phương án trên sau khi phân tích kỹ các yếu tố đã được giải thích trong bài viết <a href=https://aws.amazon.com/blogs/apn/how-to-decide-between-building-or-buying-a-cis-hardened-image/>How to Decide Between Building or Buying a CIS Hardened Image</a>.</p><p>Trong bài này, chúng tôi sẽ minh họa cách sử dụng các script được công bố bởi CIS Linux Build Kit (LBK) để tạo quy trình hardening và xác thực tự quản sử dụng <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> và <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a>. Các script cần thiết để harden hệ điều hành cụ thể (theo <a href=https://www.cisecurity.org/cis-benchmarks>CIS Benchmark</a>) được công bố trên trang CIS Workbench, có thể tải về nếu tổ chức của bạn là thành viên CIS SecureSuite®. Những script này có thể sử dụng lại với rất ít chỉnh sửa để tạo <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> Component, sau đó dùng trong các Image Builder Pipeline.</p><p>Chúng ta sẽ thực hiện cách tiếp cận này bằng việc tạo một AMI <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a> đã được harden, và kiểm tra (validate) nó bằng <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a>.</p><hr><h2 id=tổng-quan-giải-pháp>Tổng quan giải pháp</h2><p>Giải pháp bao gồm các bước chính sau:</p><p><strong>Tiền đề (Prerequisites):</strong></p><ol><li>Có tài khoản AWS với quyền thích hợp.</li><li>Tải xuống, khám phá và cập nhật CIS LBK Utility.</li><li>Tạo bucket <a href=https://aws.amazon.com/s3/>Amazon S3</a> làm môi trường staging để tải lên CIS LBK Utility.</li><li>Cấu hình bucket S3 để phát thông báo qua <a href=https://aws.amazon.com/eventbridge/>Amazon EventBridge</a>.</li></ol><p><strong>Các bước triển khai chính:</strong></p><ol><li>Xây dựng Image Building Pipeline bằng <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a>.</li><li>Xác thực image và tạo báo cáo bằng <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a>.</li></ol><hr><h2 id=tiền-đề-cho-giải-pháp>Tiền đề cho giải pháp</h2><h3 id=tải-xuống-khám-phá-và-cập-nhật-cis-lbk-utility>Tải xuống, khám phá và cập nhật CIS LBK Utility</h3><p>LBK dành cho <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a> có thể được tải từ trang CIS. Bộ công cụ này được cộng đồng CIS phát triển và duy trì, hiện được phân phối dưới dạng file <code>amazon_linux_2.tar.gz</code>.</p><p>Sau khi giải nén file tar, bạn sẽ thấy cấu trúc thư mục như sau:</p><p><img alt="Cấu trúc thư mục của Bộ công cụ xây dựng CIS Linux" src=../../../images/3-BlogsTranslated/3.3-Blog3/cis-folders.jpg></p><p><em>Hình 1: Cấu trúc thư mục của Bộ công cụ xây dựng CIS Linux</em></p><p>Thư mục chính chứa file <code>amazon_linux_2.sh</code> — script chính gọi các script phụ trong thư mục &ldquo;functions&rdquo;. Nếu bạn muốn loại trừ một số khuyến nghị, hãy thêm chúng vào file <code>exclusion_list.txt</code>.</p><p>Hướng dẫn sử dụng và nội dung của bộ công cụ được mô tả chi tiết trong Quick Start Guide đi kèm trong package. Script <code>amazon_linux_2.sh</code> bao gồm hai bước tương tác khi chạy. Để tự động hóa, bạn nên chỉnh sửa script này để cố định (hardcode) các giá trị đầu vào.</p><p>Cụ thể, bạn cần:</p><ol><li><p><strong>Chấp nhận điều khoản sử dụng (Terms and Conditions)</strong> – nên comment dòng này trong script, và nhóm CloudOps có thể cung cấp nội dung điều khoản riêng cho người dùng trong tài liệu nội bộ.</p></li><li><p><strong>Chọn profile hardening</strong> – có bốn profile: L1S, L2S, L1W, L2W tương ứng với Level 1/2 của <a href=https://www.cisecurity.org/cis-benchmarks>CIS Benchmark</a>, và loại Server (S) hoặc Workstation (W).</p></li></ol><p>Trong ví dụ này, chúng ta sẽ dùng profile L1S để harden <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a> theo chuẩn <a href=https://www.cisecurity.org/cis-benchmarks>CIS Benchmark</a> Level 1.</p><p>Các dòng cần chỉnh trong script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#terms_of_use</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Display CIS Linux Build Kit warning banner</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#WARBNR ---&gt; Comment dòng này</span>
</span></span><span style=display:flex><span>run_profile<span style=color:#f92672>=</span>L1S <span style=color:#75715e># Uncomment dòng này để chỉ định profile được chạy</span>
</span></span></code></pre></div><p>Sau khi chỉnh sửa, đóng gói lại file LBK:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar cvf amazon_linux_2.tar.gz CIS-LBK
</span></span></code></pre></div><h3 id=tạo-bucket-s3-staging-và-tải-lên-lbk>Tạo bucket S3 staging và tải lên LBK</h3><p>Tạo bucket S3 (ví dụ: <code>cis-lbk-al2</code>) bằng AWS Management Console hoặc <a href=https://aws.amazon.com/cli/>AWS CLI</a>. Bucket này được dùng để lưu trữ script LBK, phục vụ cho <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> tải xuống và tải log sau khi chạy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3api put-object --bucket cis-lbk-al2 --key amazon_linux_2.tar.gz --body amazon_linux_2.tar.gz
</span></span></code></pre></div><h3 id=cấu-hình-bucket-s3-để-gửi-thông-báo-qua-amazon-eventbridge>Cấu hình bucket S3 để gửi thông báo qua Amazon EventBridge</h3><p>Bật <a href=https://aws.amazon.com/s3/>Amazon S3</a> Event Notifications cho bucket, chọn gửi thông báo đến <a href=https://aws.amazon.com/eventbridge/>Amazon EventBridge</a>. Bạn có thể kích hoạt tính năng này trong tab Properties của bucket.</p><p><img alt="Cho phép gửi thông báo đến EventBridge từ thùng S3" src=../../../images/3-BlogsTranslated/3.3-Blog3/s3-eventbridge.jpg></p><p><em>Hình 2: Cho phép gửi thông báo đến EventBridge từ thùng S3</em></p><hr><h2 id=các-bước-triển-khai>Các bước triển khai</h2><p><img alt="Kiến trúc của giải pháp" src=../../../images/3-BlogsTranslated/3.3-Blog3/arch-diagram.jpg></p><p><em>Hình 3: Kiến trúc của giải pháp</em></p><hr><h2 id=xây-dựng-image-building-pipeline-bằng-ec2-image-builder>Xây dựng Image Building Pipeline bằng EC2 Image Builder</h2><p>Giải pháp này sử dụng các dịch vụ AWS sau:</p><ul><li><p><strong><a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a></strong>: chạy LBK từ <a href=https://aws.amazon.com/s3/>Amazon S3</a> để harden và đóng gói AMI. <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> dùng AWS Task Orchestrator and Executor (<a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/toe-component-manager.html>AWSTOE</a>) để điều phối workflow phức tạp. Bạn sẽ tạo <a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/create-custom-components.html>custom component</a> để gọi LBK từ S3, đồng thời định nghĩa image recipe làm image cơ sở (base image) và <a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/manage-image-workflows.html>image workflow</a> xác định trình tự các bước build.</p></li><li><p><strong><a href=https://aws.amazon.com/inspector/>Amazon Inspector</a></strong>: thực hiện kiểm tra bảo mật (CIS scan) để xác thực AMI sau khi harden.</p></li><li><p><strong><a href=https://aws.amazon.com/eventbridge/>Amazon EventBridge</a></strong>: tích hợp sẵn với <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> và S3 để phát sự kiện (event). Các sự kiện này có thể được chuyển tiếp đến <a href=https://aws.amazon.com/sns/>Amazon SNS</a> hoặc <a href=https://aws.amazon.com/lambda/>AWS Lambda</a>.</p></li><li><p><strong><a href=https://aws.amazon.com/sns/>Amazon SNS</a></strong>: dùng để gửi thông báo qua email về các bước kiểm duyệt (approval step).</p></li></ul><h3 id=tạo-component-tùy-chỉnh-cho-ec2-image-builder>Tạo Component tùy chỉnh cho EC2 Image Builder</h3><p>Bạn có thể sử dụng <a href=https://aws.amazon.com/cloudformation/>AWS CloudFormation</a> template (được cung cấp trong bài gốc) để khởi tạo stack tạo toàn bộ các tài nguyên được đề cập trong các phần dưới đây.</p><p>Lệnh ví dụ để triển khai stack:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudformation create-stack --stack-name cis-al2-harden-stack <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--template-body file://cis-lbk-automation-template.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--parameters
</span></span></code></pre></div><p>CloudFormation template này sẽ tự động tạo các thành phần được mô tả trong kiến trúc giải pháp.</p><p>Trong bài viết này, ta định nghĩa một <a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/create-custom-components.html>custom component</a> có tên <strong>CIS-AL2-L1S-Hardening</strong>, với các đặc điểm sau:</p><ul><li><strong>Type</strong>: build</li><li><strong>Platform</strong>: Linux và các hệ điều hành tương thích</li><li><strong>OS Version</strong>: <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a></li></ul><p>Mỗi component được định nghĩa bằng một tài liệu YAML, trong đó bucket S3 được tạo ở bước tiền đề được dùng để tải script và tải log lên. Bảng sau đây liệt kê một loạt các bước trong giai đoạn xây dựng.</p><p><img alt="Các bước của giai đoạn Xây dựng" src=../../../images/3-BlogsTranslated/3.3-Blog3/workflow-steps.jpg></p><p><em>Hình 4: Các bước của giai đoạn Xây dựng</em></p><p>Ví dụ định nghĩa component:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;CIS-Build-AL2-Level1&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#e6db74>&#39;Applies the L1S CIS settings for Amazon Linux 2 (AL2)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>schemaVersion</span>: <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>StagingS3BucketName</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>FileName</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#39;amazon_linux_2.tar.gz&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Version</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#39;2024.2.0&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Level</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#39;L1S&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>phases</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>OperatingSystemRelease</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                FILE=/etc/os-release
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                if [ -e $FILE ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                . $FILE
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;$ID${VERSION_ID:+.${VERSION_ID}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;The file $FILE does not exist. Exiting.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                fi</span>                
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GetPackageManager</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                RELEASE=&#39;{{build.OperatingSystemRelease.outputs.stdout}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                case &#34;${RELEASE}&#34; in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                amzn*|centos*|rhel*)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#39;yum&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ubuntu*)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#39;apt&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                *)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#34;Operating System &#39;${RELEASE}&#39; is not supported. Exiting.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                esac</span>                
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>VerifyPrerequisite</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                INSTALL_TYPE=&#39;{{build.GetPackageManager.outputs.stdout}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                case &#34;${INSTALL_TYPE}&#34; in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#39;yum&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    if ! yum -q list installed tar &amp;&gt;/dev/null; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    yum install -q -y tar
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#34;Installed tar.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#34;Tar is already installed.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#39;apt&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    apt install -q -y tar
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#34;Installed tar.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                *)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    echo &#34;Install type &#39;${INSTALL_TYPE}&#39; is not supported at this time. Exiting.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                esac</span>                
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MakeStagingDIR</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                mkdir cis-stage
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                cd cis-stage
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                pwd</span>                
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>SettingStagingDirPermissions</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>SetFolderPermissions</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#39;{{build.MakeStagingDIR.outputs.stdout}}&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>permissions</span>: <span style=color:#ae81ff>0700</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Download_CIS_LBK</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>S3Download</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>source</span>: <span style=color:#ae81ff>s3://{{ StagingS3BucketName }}/{{ FileName }}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>destination</span>: <span style=color:#e6db74>&#39;{{build.MakeStagingDIR.outputs.stdout}}/{{ FileName }}&#39;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Unzip_CIS_LBK</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Continue</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>sudo tar -xvf &#39;{{build.MakeStagingDIR.outputs.stdout}}/{{ FileName }}&#39; -C &#39;{{build.MakeStagingDIR.outputs.stdout}}/&#39; || ( echo &#34;File extraction failed. Exiting&#34; ; exit 1; )</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>AL2_ConfigureCIS</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteBash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Continue</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                RELEASE=&#39;{{ build.OperatingSystemRelease.outputs.stdout }}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                if [ ! `echo &#34;$RELEASE&#34; | grep -E &#34;^(amzn\.2$|(centos|rhel)\.7)&#34;` ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#39;Skipping this step for the current operating system.&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                cd {{build.MakeStagingDIR.outputs.stdout}}/CIS-LBK/cis_lbk_amazon_linux_2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                sudo ./amazon_linux_2.sh || ( echo &#34;CIS configuration script failed to run. Exiting.&#34; ; exit 1; )</span>                
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>UploadLogFiles</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>S3Upload</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>maxAttempts</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>source</span>: <span style=color:#e6db74>&#39;{{build.MakeStagingDIR.outputs.stdout}}/CIS-LBK/cis_lbk_amazon_linux_2/logs/*&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>destination</span>: <span style=color:#e6db74>&#39;s3://{{ StagingS3BucketName }}/logs/&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>recurse</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>expectedBucketOwner</span>: <span style=color:#ae81ff>&lt;&lt;your account number&gt;&gt;</span>
</span></span></code></pre></div><h3 id=tạo-image-recipe-dựa-trên-component>Tạo Image Recipe dựa trên Component</h3><p>Image Recipe là một tài liệu định nghĩa các <strong>component</strong> được áp dụng lên <strong>base image</strong> để tạo ra cấu hình mong muốn cho <strong>output image</strong>.</p><p>Recipe có tên <strong>CIS-AL2-L1S-Hardening-Recipe</strong> được tạo bằng <strong>component tùy chỉnh CIS-AL2-L1S-Hardening</strong> làm giai đoạn build chính.</p><p><strong>Mẫu AWS CloudFormation template</strong> có dạng như sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ImageRecipeCISAL2L1S</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#34;AWS::ImageBuilder::ImageRecipe&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Components</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>ComponentArn</span>: !<span style=color:#ae81ff>GetAtt CISAL2HardeningComponent.Arn</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Parameters</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>Value</span>:
</span></span><span style=display:flex><span>        - !<span style=color:#ae81ff>Sub &#34;${StagingS3BucketName}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Name</span>: <span style=color:#e6db74>&#34;StagingS3BucketName&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>WorkingDirectory</span>: <span style=color:#e6db74>&#34;/var/tmp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ParentImage</span>: !<span style=color:#ae81ff>Sub &#34;arn:aws:imagebuilder:${AWS::Region}:aws:image/amazon-linux-2-x86/x.x.x&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;1.0.0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>AdditionalInstanceConfiguration</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>SystemsManagerAgent</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>UninstallAfterBuild</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Name</span>: <span style=color:#e6db74>&#34;CIS-AL2-L1S-Hardening&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>DependsOn</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>CISAL2HardeningComponent</span>
</span></span></code></pre></div><p>Như bạn thấy, <strong>component tùy chỉnh (<a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/create-custom-components.html>custom component</a>)</strong> được tham chiếu trong recipe, đồng thời recipe cũng tham chiếu <strong>phiên bản mới nhất của <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a></strong> làm <strong>base image</strong> thông qua thuộc tính ParentImage.</p><p>Component <strong>CIS-AL2-L1S-Hardening</strong> nhận <strong>WorkingDirectory</strong> làm đầu vào.</p><div class="notices note"><p>Giá trị này phải được đặt là <code>/var/tmp</code>, vì thư mục <code>/tmp</code> mặc định sẽ bị thay đổi quyền truy cập (permission) bởi script CIS LBK, gây lỗi truy cập khi chạy.</p></div><h3 id=tạo-workflow-tùy-chỉnh-cho-quá-trình-build-image>Tạo Workflow tùy chỉnh cho quá trình Build Image</h3><p><strong>Image Workflow</strong> định nghĩa chuỗi các bước <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> thực hiện trong giai đoạn <strong>build</strong> và <strong>test</strong> của quy trình tạo image.</p><p>Workflow này giới thiệu hành động <strong>WaitForAction</strong>, giúp thêm bước <strong>phê duyệt thủ công (manual approval)</strong> sau khi quá trình hardening hoàn tất. Tại bước này, người vận hành có thể xem log và tiếp tục tạo image. Đồng thời, đây cũng là lúc có thể kích hoạt và xem kết quả <strong><a href=https://aws.amazon.com/inspector/>Amazon Inspector</a> scan</strong>.</p><p>Hành động <strong>WaitForAction</strong> sẽ tạm dừng workflow đang chạy và chờ phản hồi từ API <strong>SendWorkflowStepAction</strong> của <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a>. Sự kiện này sẽ phát <strong>EventBridge event</strong> với detail-type là &ldquo;<a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> Workflow Step Waiting&rdquo;.</p><p>Đối với bài blog này, nhóm tác giả tạo <strong>workflow tùy chỉnh</strong> có tên <strong>build-cis-hardened-manual-action</strong>, loại <strong>BUILD</strong>, với nội dung YAML như sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>build-cis-hardened-manual-action</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>Workflow to build an AMI</span>
</span></span><span style=display:flex><span><span style=color:#f92672>schemaVersion</span>: <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>LaunchBuildInstance</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>LaunchInstance</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>waitFor</span>: <span style=color:#e6db74>&#34;ssmAgent&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ApplyBuildComponents</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>ExecuteComponents</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>instanceId.$</span>: <span style=color:#e6db74>&#34;$.stepOutputs.LaunchBuildInstance.instanceId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>InventoryCollection</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>CollectImageMetadata</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>and</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>stringEquals</span>: <span style=color:#e6db74>&#34;AMI&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.imagebuilder.imageType&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>booleanEquals</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.imagebuilder.collectImageMetadata&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>instanceId.$</span>: <span style=color:#e6db74>&#34;$.stepOutputs.LaunchBuildInstance.instanceId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>RunSanitizeScript</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>SanitizeInstance</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>and</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>stringEquals</span>: <span style=color:#e6db74>&#34;AMI&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.imagebuilder.imageType&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>stringEquals</span>: <span style=color:#e6db74>&#34;Linux&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.imagebuilder.platform&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>instanceId.$</span>: <span style=color:#e6db74>&#34;$.stepOutputs.LaunchBuildInstance.instanceId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>CheckBuildLogsAndApprove</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>WaitForAction</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>CreateOutputAMI</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>CreateImage</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Abort</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>stringEquals</span>: <span style=color:#e6db74>&#34;AMI&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.imagebuilder.imageType&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>instanceId.$</span>: <span style=color:#e6db74>&#34;$.stepOutputs.LaunchBuildInstance.instanceId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>TerminateBuildInstance</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>TerminateInstance</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>onFailure</span>: <span style=color:#ae81ff>Continue</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>instanceId.$</span>: <span style=color:#e6db74>&#34;$.stepOutputs.LaunchBuildInstance.instanceId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;ImageId&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$.stepOutputs.CreateOutputAMI.imageId&#34;</span>
</span></span></code></pre></div><h3 id=tạo-image-pipeline>Tạo Image Pipeline</h3><p>Trong ví dụ của bài blog, nhóm tạo <strong>Image Pipeline</strong> có tên <strong>CIS-AL2-L1S-Hardening-pipeline</strong>.</p><p><a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> sử dụng <strong><a href=https://aws.amazon.com/inspector/>Amazon Inspector</a></strong> để quét các instance test tìm lỗ hổng bảo mật trong hệ điều hành hoặc gói phần mềm. Tuy nhiên, trong trường hợp này, tính năng quét lỗ hổng mặc định được <strong>vô hiệu hóa</strong>, vì nhóm chỉ sử dụng <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a> để <strong>thực hiện CIS scan</strong> trên <strong>output image</strong>, không thực hiện quét lỗ hổng chung.</p><p>Lịch <strong>Build Schedule</strong> được đặt ở chế độ <strong>Manual</strong>. Bạn có thể định kỳ hóa bằng <strong>Schedule Builder (CRON expression)</strong>.</p><p>Tiếp theo, nhóm chọn <strong>Image Recipe (CIS-AL2-L1S-Hardening-Recipe)</strong> đã tạo ở bước trước. Quá trình tạo image được định nghĩa bằng <strong>Custom Workflow</strong>, trong đó <strong>build-cis-hardened-manual-action</strong> được chọn làm <strong>Build workflow</strong>.</p><p>IAM Role được chọn là <strong>AWSServiceRoleForImageBuilder</strong>, cung cấp quyền truy cập cần thiết cho <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a>.</p><p>Cấu hình hạ tầng (Infrastructure Configuration) giữ nguyên mặc định, ngoại trừ việc thêm <strong>Resource Tag</strong> cho instance:</p><ul><li><strong>Key</strong>: <code>IBCISHardened</code></li><li><strong>Value</strong>: <code>Yes</code></li></ul><p>→ Thẻ này được dùng trong cấu hình <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a> làm tiêu chí lọc (filter) để quét CIS.</p><p><strong>Distribution Settings</strong> giữ nguyên mặc định – tức là <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> sẽ khởi chạy instance trong <strong>default VPC</strong>, và <strong>phân phối AMI đầu ra</strong> trong <strong>Region hiện tại</strong>.</p><p>Phần <strong>Infrastructure Configuration</strong> này tạo IAM Role và Instance Profile được sử dụng bởi build instance để cấu hình AMI. Instance Role này gắn với <strong>EC2InstanceProfileForImageBuilder</strong> và <strong>AmazonSSMManagedInstanceCore managed policy</strong>.</p><p>Để chạy <strong><a href=https://aws.amazon.com/inspector/>Amazon Inspector</a> CIS scan</strong> thành công, <strong>Instance Profile</strong> cần gắn thêm policy <strong>AmazonInspector2ManagedCisPolicy</strong>.</p><p>Cấu hình IAM Instance Profile Role có dạng như sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>IAMManagedPolicyIBCisComponentS3Access</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#34;AWS::IAM::ManagedPolicy&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ManagedPolicyName</span>: <span style=color:#e6db74>&#34;IBCisComponentS3Access&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Path</span>: <span style=color:#e6db74>&#34;/&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Description</span>: <span style=color:#e6db74>&#34;Access to S3 Bucket from EC2 ImageBuilder CIS Custom component&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>PolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>Resource</span>: <span style=color:#e6db74>&#34;arn:aws:s3:::cis-lbk-al2/*&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Action</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Effect</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>IAMRoleForImageBuilderCISAL2</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#34;AWS::IAM::Role&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ManagedPolicyArns</span>:
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/EC2InstanceProfileForImageBuilder&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>Ref</span>: <span style=color:#e6db74>&#34;IAMManagedPolicyIBCisComponentS3Access&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/AmazonInspector2ManagedCisPolicy&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>AssumeRolePolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>Action</span>: <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Effect</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Principal</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>Service</span>: <span style=color:#e6db74>&#34;ec2.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>EC2InstanceProfileForImageBuilderCISAL2</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#34;AWS::IAM::InstanceProfile&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Roles</span>:
</span></span><span style=display:flex><span>    - !<span style=color:#ae81ff>Ref &#34;IAMRoleForImageBuilderCISAL2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>InstanceProfileName</span>: <span style=color:#e6db74>&#34;EC2InstanceProfileForImageBuilderCISAL2&#34;</span>
</span></span></code></pre></div><h3 id=gắn-bucket-policy-cho-s3-bucket-cis-lbk-al2>Gắn Bucket Policy cho S3 Bucket cis-lbk-al2</h3><p>Chính sách này chỉ cho phép IAM Role của Instance Profile truy cập bucket:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Sid&#34;</span>: <span style=color:#e6db74>&#34;Statement1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Principal&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;AWS&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:iam::7284282*****:role/IAMRoleForImageBuilderCISAL2&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:s3:::cis-lbk-al2&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=tạo-amazon-sns-topic-cho-email-notification>Tạo Amazon SNS Topic cho Email Notification</h3><p>Nhóm tạo một <strong>SNS Topic</strong> có tên <code>ImageBuilderQueue</code>, kèm theo <strong>Email Subscription</strong> để gửi thông báo cho người phụ trách quy trình.</p><h3 id=tạo-amazon-eventbridge-rules-để-gửi-thông-báo>Tạo Amazon EventBridge Rules để gửi thông báo</h3><p>Hai <strong>EventBridge rule</strong> được tạo để gửi thông báo qua SNS:</p><p><strong>Rule 1 – Thông báo khi workflow chờ phê duyệt (WaitForAction):</strong></p><p>Khi <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> phát sự kiện &ldquo;Workflow Step Waiting&rdquo; cho bước <strong>CheckBuildLogsAndApprove</strong>, rule này gửi thông điệp đến SNS Topic <code>ImageBuilderQueue</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#39;2010-09-09&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Description</span>: <span style=color:#ae81ff>CloudFormation template for EventBridge Rule ec2-imagebuilder</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Rule41742a2e</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Events::Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Name</span>: <span style=color:#ae81ff>ec2-imagebuilder</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>EventPattern</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {&#34;source&#34;:[&#34;aws.imagebuilder&#34;],&#34;detail-type&#34;:[&#34;EC2 Image Builder Workflow Step Waiting&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &#34;detail&#34;:{&#34;workflow-step-name&#34;:[&#34;CheckBuildLogsAndApprove&#34;]}}</span>        
</span></span><span style=display:flex><span>      <span style=color:#f92672>State</span>: <span style=color:#ae81ff>ENABLED</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>EventBusName</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Arn</span>: !<span style=color:#ae81ff>Sub &#34;arn:${AWS::Partition}:sns:${AWS::Region}:${AWS::AccountId}:ImageBuilderQueue&#34;</span>
</span></span></code></pre></div><p><strong>Rule 2 – Thông báo khi log CIS được tạo trong S3 bucket:</strong></p><p>Khi một object <code>CIS-LBK.log</code> được tạo trong đường dẫn <code>/logs/.../</code>, EventBridge sẽ gửi thông báo đến SNS topic <code>ImageBuilderQueue</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#39;2010-09-09&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Description</span>: <span style=color:#ae81ff>CloudFormation template for EventBridge Rule CISHardeningExitLogEvent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Rule104d463b</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Events::Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Name</span>: <span style=color:#ae81ff>CISHardeningExitLogEvent</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>EventPattern</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {&#34;source&#34;:[&#34;aws.s3&#34;],&#34;detail-type&#34;:[&#34;Object Created&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &#34;detail&#34;:{&#34;bucket&#34;:{&#34;name&#34;:[&#34;cis-lbk-al2&#34;]},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &#34;object&#34;:{&#34;key&#34;:[{&#34;wildcard&#34;:&#34;logs/*CIS-LBK.log&#34;}]}}}</span>        
</span></span><span style=display:flex><span>      <span style=color:#f92672>State</span>: <span style=color:#ae81ff>ENABLED</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>EventBusName</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Arn</span>: !<span style=color:#ae81ff>Sub &#34;arn:${AWS::Partition}:sns:${AWS::Region}:${AWS::AccountId}:ImageBuilderQueue&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>InputTransformer</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>InputPathsMap</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>bucketname</span>: <span style=color:#ae81ff>$.detail.bucket.name</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>objectkey</span>: <span style=color:#ae81ff>$.detail.object.key</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>region</span>: <span style=color:#ae81ff>$.region</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>InputTemplate</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              &#34;Review the output log for the CIS Hardening process in &lt;bucketname&gt; bucket at &lt;objectkey&gt;.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>               Log URL: https://&lt;bucketname&gt;.s3.&lt;region&gt;.amazonaws.com/&lt;objectkey&gt;&#34;</span>              
</span></span></code></pre></div><h3 id=chạy-image-pipeline>Chạy Image Pipeline</h3><p>Bạn có thể khởi chạy pipeline từ <strong>AWS Console</strong> hoặc <strong><a href=https://aws.amazon.com/cli/>AWS CLI</a></strong>.</p><p>Lệnh CLI mẫu:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws imagebuilder start-image-pipeline-execution <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--image-pipeline-arn arn:aws:imagebuilder:<span style=color:#f92672>{</span>REGION<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>ACCOUNT_ID<span style=color:#f92672>}</span>:image-pipeline/CIS-AL2-L1S-Hardening-pipeline
</span></span></code></pre></div><p>Kết quả trả về:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;requestId&#34;</span>: <span style=color:#e6db74>&#34;a1b2c3d4-5678-90ab-cdef-EXAMPLE11111&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;clientToken&#34;</span>: <span style=color:#e6db74>&#34;a1b2c3d4-5678-90ab-cdef-EXAMPLE22222&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;imageBuildVersionArn&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:imagebuilder:{REGION}:{ACCOUNT_ID}:image/cis-al2-l1s-hardening/1.0.1/1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Ghi chú <code>imageBuildVersionArn</code> và <code>stepExecutionId</code>. Pipeline sẽ <strong>tạm dừng</strong> tại bước <code>CheckBuildLogsAndApprove</code>.</p><p>Kiểm tra trạng thái chờ qua lệnh:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws imagebuilder list-waiting-workflow-step
</span></span></code></pre></div><p>Khi chạy thành công, bạn sẽ nhận <strong>2 email thông báo</strong>:</p><ul><li>Một email từ <strong>S3 EventBridge</strong> chứa link log file CIS-LBK.</li><li>Một email từ <strong>Image Builder</strong> yêu cầu phê duyệt bước chờ.</li></ul><p>Ví dụ nội dung log notification:</p><pre tabindex=0><code>&#34;Review the output log for the CIS Hardening process in &#39;cis-lbk-al2&#39; bucket, location &#39;logs/08_27_2024_1210/CIS-LBK.log&#39;...&#34;
</code></pre><hr><h2 id=kiểm-thử-image-bằng-amazon-inspector>Kiểm thử Image bằng Amazon Inspector</h2><p>Trong giai đoạn chờ, bạn tạo <strong>CIS scan</strong> một lần (one-time) bằng <a href=https://aws.amazon.com/inspector/>Amazon Inspector</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws inspector2 create-cis-scan-configuration <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--scan-name cis-hardened-scan <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--schedule oneTime<span style=color:#f92672>={}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--security-level <span style=color:#e6db74>&#34;LEVEL_1&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--targets <span style=color:#e6db74>&#34;accountIds=&lt;&lt;account_id&gt;&gt;,targetResourceTags={IBCISHardened=Yes}&#34;</span>
</span></span></code></pre></div><p>Theo dõi tiến trình scan:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws inspector2 list-cis-scans <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--filter-criteria <span style=color:#e6db74>&#34;scanConfigurationArnFilters=[{comparison=EQUALS,value=&lt;&lt;scanConfigurationArn&gt;&gt;}]&#34;</span>
</span></span></code></pre></div><p>Sau khi hoàn tất, tải <strong>báo cáo PDF</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws inspector2 get-cis-scan-report --scan-arn &lt;&lt;scan-arn&gt;&gt; --report-format PDF
</span></span></code></pre></div><p>Kết quả trả về URL của báo cáo, có thể mở bằng trình duyệt đã đăng nhập AWS.</p><h3 id=tiếp-tục-hoặc-dừng-workflow>Tiếp tục hoặc dừng workflow</h3><p>Sau khi xem log và báo cáo:</p><p><strong>Tiếp tục pipeline:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws imagebuilder send-workflow-step-action <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--step-execution-id <span style=color:#e6db74>&lt;&lt;stepExecutionId&gt;&gt; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--image-build-vers</span>ion-arn <span style=color:#e6db74>&lt;&lt;imageBui</span>ldVersionArn&gt;&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--action RESUME
</span></span></code></pre></div><p><strong>Hoặc dừng pipeline:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws imagebuilder send-workflow-step-action <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--step-execution-id <span style=color:#e6db74>&lt;&lt;stepExecutionId&gt;&gt; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--image-build-vers</span>ion-arn <span style=color:#e6db74>&lt;&lt;imageBui</span>ldVersionArn&gt;&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--action STOP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--reason <span style=color:#e6db74>&#34;Please fix the issue and recreate the Image&#34;</span>
</span></span></code></pre></div><p>Khi hoàn tất, xem AMI output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws imagebuilder get-image <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--image-build-version-arn <span style=color:#e6db74>&lt;&lt;imageBuildVersionArn&gt;&gt; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--query &#39;image</span>.outputResources.amis<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.image<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><hr><h2 id=kết-luận>Kết luận</h2><p>Trong bài viết này, chúng tôi đã thiết lập quy trình dựa trên <a href=https://aws.amazon.com/image-builder/>EC2 Image Builder</a> để harden AMI <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a> theo CIS <a href=https://aws.amazon.com/amazon-linux-2/>Amazon Linux 2</a> Benchmark bằng cách sử dụng CIS Linux Build Kit do cộng đồng CIS cung cấp.</p><p>Chúng tôi cũng tận dụng thông báo dựa trên sự kiện (event-based) từ <a href=https://aws.amazon.com/s3/>Amazon S3</a> và <a href=https://aws.amazon.com/eventbridge/>Amazon EventBridge</a> để kích hoạt email phê duyệt và giới thiệu quy trình manual approval.</p><p>Framework này có thể mở rộng để harden các AMI khác như <strong>Ubuntu</strong> hoặc <strong>CentOS</strong>, sử dụng các bộ LBK tương ứng từ cộng đồng CIS.</p><p>Hãy liên hệ với <a href=https://aws.amazon.com/contact-us/sales-support-cloudops/>đại diện AWS</a> để được hỗ trợ triển khai quy trình này cho doanh nghiệp của bạn.</p><hr><h2 id=đọc-thêm>Đọc thêm</h2><ul><li><a href=https://docs.aws.amazon.com/imagebuilder/latest/userguide/toe-cis.html>CIS hardening components for EC2 Image Builder</a></li><li><a href=https://aws.amazon.com/blogs/containers/build-a-pipeline-for-hardened-container-images-using-ec2-image-builder-and-terraform/>Build a pipeline for hardened container images using EC2 Image Builder and Terraform</a></li><li><a href=https://docs.aws.amazon.com/inspector/latest/user/inspector_best_practices.html>Amazon Inspector Best Practices</a></li></ul><hr><h2 id=về-tác-giả>Về tác giả</h2><p><strong>Rajat Chatterjee</strong></p><p>Rajat là Kiến trúc sư Giải pháp cấp cao (Senior Solutions Architect), làm việc cùng các khách hàng trong lĩnh vực Dịch vụ Tài chính bao gồm Ngân hàng, Bảo hiểm và Thị trường Vốn, nhằm hỗ trợ họ xây dựng các ứng dụng đáng tin cậy, an toàn và hiệu năng cao trên nền tảng đám mây.</p><p>Anh có chuyên môn trong việc triển khai quy mô lớn các khối lượng công việc dựa trên microservices trên nền tảng container dành cho các doanh nghiệp.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/3.2-blog2/ title="Xây dựng pipeline Apache Spark end-to-end với Amazon MWAA, Batch Processing Gateway và Amazon EMR trên EKS"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/4-eventparticipated/ title="Các events đã tham gia" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765512673></script><script src=../../../js/perfect-scrollbar.min.js?1765512673></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765512673></script><script src=../../../js/jquery.sticky.js?1765512673></script><script src=../../../js/featherlight.min.js?1765512673></script><script src=../../../js/highlight.pack.js?1765512673></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765512673></script><script src=../../../js/learn.js?1765512673></script><script src=../../../js/hugo-learn.js?1765512673></script><link href=../../../mermaid/mermaid.css?1765512673 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765512673></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>